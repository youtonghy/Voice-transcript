音频自动分句的核心实现逻辑

1. 关键参数设置

- 静音阈值：RMS值小于0.010被视
  为静音
- 分割时长：连续静音超过1.0秒触
  发分割
- 预录时长：在检测到语音前保留1
  .0秒的音频缓冲

2. 实时音频处理流程

系统通过音频回调函数实时监控音
频流，每个音频块都会：
- 计算当前音频块的RMS音量值（均
  方根值）
- 与静音阈值比较判断是否为语音
  或静音
- 维护连续静音帧的计数器

3. 语音活动检测（VAD）机制

语音开始检测：
- 当系统处于非活跃状态且RMS值超
  过静音阈值时
- 立即标记为语音活动开始
- 将之前缓存的预录音频合并到当
  前段
- 重置分段计数器

语音结束检测：
- 在语音活跃期间，持续监控RMS值
- 当RMS值低于静音阈值时，开始累
  计静音帧数
- 一旦连续静音时长达到1秒（采样
  率×1秒），触发分割

4. 分段处理策略

预录缓冲机制：
-
系统始终维护一个1秒的音频缓冲区
- 当检测到语音开始时，将缓冲区
  内容合并到新分段
- 确保捕获到语音开始前的完整上
  下文

分割触发条件：
-
连续静音超过设定阈值（默认1秒）
- 系统立即将当前累积的音频数据
  作为一个完整分段
- 分段被异步发送到转录处理线程

5. 音量计算方法

使用RMS（均方根）算法计算音频响
度：
RMS =
sqrt(平均(音频样本的平方))
这种方法能准确反映音频的感知响
度，比简单的振幅更可靠。

6. 状态管理

系统维护多个状态变量：
- segment_active：当前是否处于
  语音分段状态
- silence_frames_contig：连续静
  音帧计数
- split_requested：是否请求分割
  当前分段
-
pre_roll_chunks：预录音频缓冲区

7. 配置灵活性

所有关键参数都支持运行时配置：
- 静音阈值可调节（适应不同环境
  噪音）
- 分割时长可调节（适应不同语速
  和停顿习惯）
- 参数变更会立即生效
